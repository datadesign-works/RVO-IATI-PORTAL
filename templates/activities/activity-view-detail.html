<div id="main-content" ng-if="!vm.activity && !vm.loading">

    <div class="container extra">

        <div class="white no-margin-bottom">
            <h1>Not found</h1>
        </div>

        <h4>Please contact the administrators if you feel this page is shown in error.</h4>
    </div>

</div>

<div id="main-content" class="activity" ng-if="vm.activity">

    <div class="container extra">

        <div class="detailview white no-margin-bottom no-padding-bottom">
            <h1 class="no-margin-bottom">{{vm.activity.title.narratives[0].text}}</h1>         
        </div>

        <hr class="darkblue no-margin-bottom">

        <sub-navbar 
            tabs='vm.tabs' 
            selected-tab='vm.selectedTab'>
        </sub-navbar>

        <div class="content-offset detailview" ng-show="vm.selectedTab == 'summary'">
    
            <div class="row">
                <div class="col-md-8">
                    <div class="featured-image">
                        <img src="{{vm.templateBaseUrl}}/images/Develop2Build header.jpg">
                    </div>
                    <div class="white">
                        <h2>Description</h2>
                        <p>{{vm.activity.description[0].narratives[0].text}}</p>              
                    </div>
                    <div class="white no-margin-bottom no-padding-bottom">
                        <h2>Location</h2>
                    </div>
                    <div class="map">
                        <activity-geomap map-height="350px" activity="vm.activity"></activity-geomap>
                    </div>
                    <div class="white no-margin-bottom no-padding-bottom">
                        <h2>Goals & results</h2>
                    </div>

                    <div class="panel lightblue no-margin-bottom with-table" ng-repeat="result in vm.activity.results" ng-if="vm.activity.results.length != 0">
                        <h4>{{result.title.narratives[0].text}}</h4>
                        <p style="margin-bottom:10px;">{{result.description.narratives[0].text}}</p>
                        <div class="table-responsive">
                            <table class="finance no-blue no-margin" ng-if="vm.activity.results.length != 0">
                                <thead>
                                    <tr>
                                        <th width="200">Unit of result</th>
                                        <th>Period start</th>
                                        <th>Period end</th>
                                        <th>Planned result</th>
                                        <th>Obtained result</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            {{result.indicator[0].title.narratives[0].text ? result.indicator[0].title.narratives[0].text : 'Not available yet'}}
                                        </td>
                                         <td>
                                            {{result.indicator[0].period[0].period_start ? result.indicator[0].period[0].period_start : 'No data' | date : 'dd-MM-yyyy'}}
                                        </td>
                                         <td>
                                            {{result.indicator[0].period[0].period_end ? result.indicator[0].period[0].period_end : 'No data' | date : 'dd-MM-yyyy'}}
                                        </td>
                                        <td>
                                            {{result.indicator[0].period[0].target.value ? result.indicator[0].period[0].target.value : 'Not available yet'}}
                                        </td>
                                        <td>
                                            {{result.indicator[0].period[0].actual.value ? result.indicator[0].period[0].actual.value : 'Not available yet'}}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="panel lightblue" ng-if="vm.activity.results.length == 0">
                        No data avaiable yet
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="panel with-table lightblue">
                        <h3>Information</h3>
                        <hr>
                        <table class="no-format">
                            <tr>
                                <td width="130">Project number: </td>
                                <td>{{vm.activity.iati_identifier}}</td>
                            </tr>
                            <tr>
                                <td>Last updated:</td>
                                <td>{{vm.activity.last_updated_datetime | date : 'd MMM yyyy'}}</td>
                            </tr>
                            <tr>
                                <td>Contact:</td>
                                <td><a href="mailto:iati@rvo.nl">iati@rvo.nl</a></td>
                            </tr>
                        </table>
                    </div>
                    <div class="panel with-table lightblue">
                        <h3>Project details</h3>
                        <hr>

                        <table class="no-format">
                            <tr>
                                <td>Start date:</td>
                                <td>{{vm.activity.activity_dates[1].iso_date ? vm.activity.activity_dates[1].iso_date : 'No data available yet' | date : 'dd-MM-yyyy'}}</td>
                            </tr>
                            <tr>
                                <td>End date:</td>
                                <td>{{vm.activity.activity_dates[3].iso_date ? vm.activity.activity_dates[3].iso_date : 'No data available yet' | date : 'dd-MM-yyyy'}}</td>
                            </tr>
                            <tr class="panel lightblue">
                                <td>Country:</td>
                                <td><a ng-repeat="recipient_country in vm.activity.recipient_countries" ui-sref="country({ country_id: recipient_country.country.code })">{{recipient_country.country.name}}{{$last ? '' : ', '}}</a><span ng-if='vm.activity.recipient_countries.length == 0'>No data available yet</span> </td>
                            </tr>
                            <tr>
                                <td width="130">Sectors: </td>
                                <td><a ui-sref="sector({ sector_id: vm.activity.sectors[0].sector.code })">
                                    {{vm.activity.sectors[0].sector.name}}
                                </a><span ng-show='!vm.activity.sectors.length'>No data available yet</span></td>
                            </tr>
                            <tr>
                                <td>Programme:</td>
                                <td><a ui-sref="programme({ programme_id: vm.activity.related_activities[0].ref })">
                                    {{vm.activity.related_activities[0].name}}
                                </a><span ng-if="!vm.activity.related_activities[0].ref">No data available yet</span></td>
                            </tr>
                            <tr>
                                <td>Total budget: </td>
                                <td><span ng-if='vm.budget'>{{vm.budget | shortcurrency :'â‚¬'}}</span>
                                <span ng-if='!vm.budget'>No data available yet</span></td>
                            </tr>
                            <tr>
                                <td>Budget spent:</td>
                                <td>
                                    <div class="progress small">
                                        <div class="progress-bar" role="progressbar" aria-valuenow="vm.budgetLeft" aria-valuemin="0" aria-valuemax="100" ng-style="vm.progressStyle">
                                            <span class="spent">{{vm.budgetLeft}}% spent</span>
                                        <div class="gradient"></div>
                                      </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Funding partners:</td>
                                <td>
                                    <span class="show-me" ng-if="org.role.code == 1" ng-repeat='org in vm.activity.participating_organisations'>
                                    {{org.narratives[0].text}}{{$last ? '' : ', '}}</span>
                                    <span class="hide-me">No data available yet</span></td>
                            </tr>
                            <tr>
                                <td>Project partners:</td>
                                <td>
                                    <span class="show-me" ng-if="org.role.code == 4" ng-repeat='org in vm.activity.participating_organisations'>
                                    {{org.narratives[0].text}}{{$last ? '' : ', '}}</span>
                                    <span class="hide-me">No data available yet</span>
                                </td>
                            </tr>
                            <tr>
                                <td>Status:</td>
                                <td>{{vm.activity.activity_status.name}}</td>
                            </tr>
                            <tr>
                                <td>(Un)tied:</td>
                                <td><span ng-if='vm.activity.default_tied_status.name.length'>
                                    {{vm.activity.default_tied_status.name}}
                                </span>
                                <span ng-if='!vm.activity.default_tied_status.name.length'>
                                    No data available yet
                                </span></td>
                            </tr>
                            <tr>
                                <td>Policy marker:</td>
                                <td>No data available yet</td>
                            </tr>
                        </table>
                    </div>
                    <div class="panel lightblue">
                        <h3>Project updates</h3>
                        <hr>
                        <p>No updates available.</p>
                        <!-- <div class="video">
                            <iframe width="581" height="215" src="https://www.youtube.com/embed/Ygng2822jMQ" frameborder="0" allowfullscreen></iframe>
                        </div> -->
                    </div>
                     <div class="panel lightblue">
                        <h3>Related documents</h3>
                        <hr>
                            <p ng-show="vm.activity.document_links.length == 0">
                                No documents available.
                            </p>
                            <ul ng-if="vm.activity.document_links.length != 0" class="fa-ul">
                                <li ng-repeat="document in vm.activity.document_links">
                                    <a target="_blank" href="{{document.url}}">
                                        <i class="fa-li fa fa-download"></i>{{document.title[0].narratives[0].text}}
                                    </a>
                                </li>
                            </ul>
                    </div>
                    <div class="panel lightblue with-table share">
                        <h3>Export & share</h3>
                        <hr>
                        <table class="no-format">
                            <tr>
                                <td width="130">Download:</td>
                                <td><a ng-click="vm.download('json')"><i class="fa fa-download"></i>JSON</a></td>
                            </tr>
                            <tr>
                                <td>Share:</td>
                                <td>
                                    <a target="_blank" ng-href="http://twitter.com/home?status={{vm.shareDescription}}"><i class="fa fa-twitter-square"></i></a>
                                    <a target="_blank" ng-href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]={{vm.pageUrl}}"><i class="fa fa-facebook-square"></i></a>
                                    <a target="_blank" ng-href="http://www.linkedin.com/shareArticle?mini=true&url={{vm.pageUrl}}&title={{vm.shareDescription}}"><i class="fa fa-linkedin-square"></i></a>
                                    <a href="mailto:?&subject={{vm.shareDescription}}&body={{vm.pageUrl}}"><i class="fa fa-envelope-square"></i></a>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- detailed report page -->
        <div class="row detailview" ng-if="vm.selectedTab == 'detailedreport'">

            <div class="col-md-12">

                <div class="panel lightblue with-table">

                    <h3>Dates & description</h3>
                    <hr>
                    <table class="no-format">
                        <tr>
                            <td width="200">RVO Project: </td>
                            <td>{{vm.activity.iati_identifier}}</td>
                        </tr>
                        <tr>
                            <td>Title:</td>
                            <td>{{vm.activity.title.narratives[0].text}}</td>
                        </tr>
                        <tr>
                            <td>Description:</td>
                            <td>{{vm.activity.description[0].narratives[0].text}}</td>
                        </tr>
                        <tr>
                            <td>Description name:</td>
                            <td>{{vm.activity.description[0].type.name}}</td>
                        </tr>
                        <tr>
                            <td>Status:</td>
                            <td>{{vm.activity.activity_status.name}}</td>
                        </tr>
                        <tr>
                            <td>Start date planned:</td>
                            <td>{{vm.activity.activity_dates[0].iso_date ? vm.activity.activity_dates[0].iso_date : 'No data available yet' | date : 'dd-MM-yyyy'}}</td>
                        </tr>
                        <tr>
                            <td>Start date actual:</td>
                            <td>{{vm.activity.activity_dates[1].iso_date ? vm.activity.activity_dates[1].iso_date : 'No data available yet' | date : 'dd-MM-yyyy'}}</td>
                        </tr>
                        <tr>
                            <td>End date planned:</td>
                            <td>{{vm.activity.activity_dates[2].iso_date ? vm.activity.activity_dates[2].iso_date : 'No data available yet' | date : 'dd-MM-yyyy'}}</td>
                        </tr>
                        <tr>
                            <td>End date actual:</td>
                            <td>{{vm.activity.activity_dates[3].iso_date ? vm.activity.activity_dates[3].iso_date : 'No data available yet' | date : 'dd-MM-yyyy'}}</td>
                        </tr>
                    </table>
                </div>

                <div class="panel lightblue with-table">

                    <h3>Related activities</h3>
                    <hr>

                    <table class="no-format">
                        <tr>
                            <td width="200">Related activity name:</td>
                            <td>{{vm.activity.related_activities[0].name}}<span ng-if="!vm.activity.related_activities[0].name">No data available yet</span></td>
                        </tr>
                        <tr>
                            <td>Related activity ref:</td>
                            <td>{{vm.activity.related_activities[0].ref}}<span ng-if="!vm.activity.related_activities[0].ref">No data available yet</span></td>
                        </tr>
                        <tr>
                            <td>Related activity type:</td>
                            <td>{{vm.activity.related_activities[0].type.name}}<span ng-if="!vm.activity.related_activities[0].type.name">No data available yet</span></td>
                        </tr>
                    </table>
                </div>

                <div class="panel lightblue with-table">

                    <h3>Related organisations</h3>
                    <div class="table-responsive">
                        <table class="finance no-blue" ng-if="vm.activity.participating_organisations">
                            <thead>
                                <tr>
                                    <th>Participating org.</th>
                                    <th>Participating org. role</th>
                                    <th>Participating org. ref.</th>
                                    <th>Participating org. type</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="org in vm.activity.participating_organisations">
                                    <td>
                                        {{org.narratives[0].text}}
                                    </td>
                                    <td>
                                        {{org.role.name}}
                                        <span ng-if="!org.role.name">-</span>
                                    </td>
                                    <td>
                                        {{org.ref}}
                                        <span ng-if="!org.ref">-</span>
                                    </td>
                                    <td>
                                        {{org.type.name}}
                                        <span ng-if="!org.type.name">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-if="!vm.activity.participating_organisations">
                        <hr>
                        <p style="padding-left:15px;padding-bottom:10px;">No data available yet</p>
                    </div>
                </div>

                <div class="panel lightblue with-table">

                    <h3>Related countries</h3>
                    <div class="table-responsive">
                        <table class="finance no-blue" ng-if="vm.activity.recipient_countries.length != 0">
                            <thead>
                                <tr>
                                    <th>Country</th>
                                    <th>Region</th>
                                    <th>Latitude</th>
                                    <th>Longitude</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="country in vm.activity.recipient_countries">
                                    <td>
                                        {{country.country.name}}
                                    </td>
                                    <td>
                                        {{country.region}}
                                        <span ng-if="!country.region">-</span>
                                    </td>
                                    <td>
                                        {{country.latitude}}
                                        <span ng-if="!country.latitude">-</span>
                                    </td>
                                    <td>
                                        {{country.longitude}}
                                        <span ng-if="!country.longitude">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-if="vm.activity.recipient_countries.length == 0">
                        <hr>
                        <p style="padding-left:15px;padding-bottom:10px;">No data available yet</p>
                    </div>

                </div>

                <div class="panel lightblue with-table">

                    <h3>Related sectors</h3>
                    
                    <table class="finance no-blue" ng-if="vm.activity.sectors.length != 0">
                        <thead>
                            <tr>
                                <th>Sector</th>
                                <th>Policy marker</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="(key, sector) in vm.activity.sectors">
                                <td>
                                    {{sector.sector.name}}
                                </td>
                                <td>
                                    {{sector.marker}}
                                    <span ng-if="!sector.marker">-</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div ng-if="vm.activity.sectors.length == 0">
                        <hr>
                        <p style="padding-left:15px;padding-bottom:10px;">No data available yet</p>
                    </div>

                </div>

           
                <div class="panel lightblue with-table">

                    <h3>Transactions</h3>
                    <div class="table-responsive">
                        <table class="finance no-blue" ng-if="vm.transactionData.length != 0">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Provider</th>
                                    <th>Provider ref.</th>
                                    <th>Provider act. id</th>
                                    <th>Receiver</th>
                                    <th>Receiver ref.</th>
                                    <th>Receiver act. id</th>
                                    <th>Value</th>
                                    <th>Date</th>
                                    <th>Value date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="transaction in vm.transactionData">
                                    <td>
                                        {{transaction.transaction_type.name}}
                                    </td>
                                    <td>
                                        {{transaction.provider_organisation.narratives[0].text}}
                                        <span ng-if="!transaction.provider_organisation">-</span>
                                    </td>
                                    <td>
                                        {{transaction.provider_organisation.ref}}
                                        <span ng-if="!transaction.provider_organisation.ref">-</span>
                                    </td>
                                    <td>
                                        {{transaction.provider_organisation.receiver_activity_id}}
                                        <span ng-if="!transaction.provider_organisation.receiver_activity_id">-</span>
                                    </td>
                                    <td>
                                        {{transaction.receiver_organisation.narratives[0].text}}
                                        <span ng-if="!transaction.receiver_organisation">-</span>
                                    </td>
                                    <td>
                                        {{transaction.receiver_organisation.ref}}
                                        <span ng-if="!transaction.receiver_organisation.ref">-</span>
                                    </td>
                                    <td>
                                        {{transaction.receiver_organisation.receiver_activity_id}}
                                        <span ng-if="!transaction.receiver_organisation.receiver_activity_id">-</span>
                                    </td>
                                    <td>{{transaction.value | shortcurrency :'â‚¬'}}</td>
                                    <td>{{transaction.transaction_date | date : 'dd-MM-yyyy'}}</td>
                                    <td>{{transaction.value_date | date : 'dd-MM-yyyy'}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-if="vm.transactionData.length == 0">
                        <hr>
                        <p style="padding-left:15px;">No data available yet</p>
                        <hr>
                    </div>

                    <table class="no-format">
                        <tr>
                            <td>
                                <div class="progress small">
                                    <div class="progress-bar" role="progressbar" aria-valuenow="vm.budgetLeft" aria-valuemin="0" aria-valuemax="100" ng-style="vm.progressStyle">
                                        <span class="spent">{{vm.budgetLeft}}% of budget spent</span>
                                    <div class="gradient"></div>
                                  </div>
                                </div>
                            </td>
                        </tr>
                    </table>

                    <hr style="margin-top:5px;">

                    <table class="no-format">
                        <tr>
                            <td>
                                <nvd3 options="vm.transactionChartOptions" data="vm.transactionChartData" class="with-3d-shadow with-transitions"></nvd3>
                            </td>
                        </tr>
                    </table>

                </div>

                <div class="panel lightblue with-table">

                    <h3>Results</h3>
                    <div class="table-responsive">
                        <table class="finance no-blue" ng-if="vm.activity.results.length != 0">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Type</th>
                                    <th>Indicator</th>
                                    <th>Baseline year</th>
                                    <th>Baseline value</th>
                                    <th>Period start</th>
                                    <th>Period end</th>
                                    <th>Target value</th>
                                    <th>Actual value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="result in vm.activity.results">
                                    <td>
                                        {{result.title.narratives[0].text ? result.title.narratives[0].text : '-'}}
                                    </td>
                                    <td>
                                        {{result.description.narratives[0].text ? result.description.narratives[0].text : '-'}}
                                    </td>
                                    <td>
                                        {{result.type.name ? result.type.name : '-'}}
                                    </td>
                                    <td>
                                        {{result.indicator[0].title.narratives[0].text ? result.indicator[0].title.narratives[0].text : '-'}}
                                    </td>
                                    <td>
                                        {{result.indicator[0].baseline.year ? result.indicator[0].baseline.year : '-'}}
                                    </td>
                                    <td>
                                        {{result.indicator[0].baseline.value ? result.indicator[0].baseline.value : '-'}}
                                    </td>
                                    <td>
                                        {{result.indicator[0].period[0].period_start ? result.indicator[0].period[0].period_start : '-' | date : 'dd-MM-yyyy'}}
                                    </td>
                                    <td>
                                        {{result.indicator[0].period[0].period_end ? result.indicator[0].period[0].period_end : '-' | date : 'dd-MM-yyyy'}}
                                    </td>
                                    <td>
                                        {{result.indicator[0].period[0].target.value ? result.indicator[0].period[0].target.value : '-'}}
                                    </td>
                                    <td>
                                        {{result.indicator[0].period[0].actual.value ? result.indicator[0].period[0].actual.value : '-'}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div ng-if="vm.activity.results.length == 0">
                        <hr>
                        <p style="padding-left:15px;padding-bottom:10px;">No data available yet</p>
                    </div>
                </div>

            </div>

    </div>
</div>


